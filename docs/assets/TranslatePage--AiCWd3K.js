import{d as H,H as Q,V as ie,r as D,w as ce,N as m,W as O,Q as n,P as a,O as U,E as q,X as A,F as J,Y as Z,J as r,c as b,Z as P,_ as Te,$ as ue,o as De,l as F,a0 as Ce,a1 as We,a2 as Ie,a3 as Ee,a4 as Ne,a5 as Ue}from"./index-_xkkRB8N.js";import{b as pe,c as Fe,e as Le,f as S,g as v,h as _e,i as Y,j as Re,k as K,m as Ve,u as Be,n as $e,o as ze,p as Oe,q as Ae,r as Me,s as Qe,t as Je,v as Pe,B as M,w as qe,S as He,x as Ye,y as je}from"./naive-ui-bt9PjZRY.js";import"./jsonp-D39q6JdT.js";import{e as Ge,d as Xe}from"./index-CRKSMmqt.js";import"./vueuc-DBJOgINh.js";import"./evtd-CI_DDEu_.js";import"./seemly-BnMaWAAC.js";import"./vooks-Bd_ZuNX8.js";import"./vdirs-DRH9Xvnd.js";import"./css-render-C8qIhfV-.js";import"./lodash-es-Bm1w-iyq.js";import"./treemate-HRdUPn5m.js";import"./date-fns-Db9XENWt.js";import"./debug-C-siL6uO.js";import"./ms-nT7xfLs5.js";import"./mitt-DJ65BbbF.js";import"./vue-router-C2tAhWqu.js";const Ze="/SekaiTextWeb/assets/chr_1-DQW-aNpz.png",Ke="/SekaiTextWeb/assets/chr_10-BeCAiu-L.png",et="/SekaiTextWeb/assets/chr_11-QyH0zYvy.png",tt="/SekaiTextWeb/assets/chr_12-DvQXYNz9.png",nt="/SekaiTextWeb/assets/chr_13-Ds_r_Fg2.png",at="/SekaiTextWeb/assets/chr_14-CC7_gFrS.png",st="/SekaiTextWeb/assets/chr_15-DmUjDCmu.png",ot="/SekaiTextWeb/assets/chr_16--4jyHACZ.png",lt="/SekaiTextWeb/assets/chr_17-B-GzYsH3.png",rt="/SekaiTextWeb/assets/chr_18-XnAPW48q.png",it="/SekaiTextWeb/assets/chr_19-D4sa1GrN.png",ct="/SekaiTextWeb/assets/chr_2-Chb6YM6b.png",ut="/SekaiTextWeb/assets/chr_20-C1ITHZ4M.png",pt="/SekaiTextWeb/assets/chr_21-BndbYb0p.png",_t="/SekaiTextWeb/assets/chr_22-C0V_mV75.png",dt="/SekaiTextWeb/assets/chr_23-n1XLQukk.png",gt="/SekaiTextWeb/assets/chr_24-UfeiNvyT.png",ft="/SekaiTextWeb/assets/chr_25-B6cUaGWi.png",ht="/SekaiTextWeb/assets/chr_26-tDQ5l0cy.png",mt="/SekaiTextWeb/assets/chr_27-DO07DQDy.png",vt="/SekaiTextWeb/assets/chr_28-DQv1Y4Iw.png",kt="/SekaiTextWeb/assets/chr_29-DfIyGUJy.png",yt="/SekaiTextWeb/assets/chr_3-obIKukRD.png",bt="/SekaiTextWeb/assets/chr_30-DVzm13Hq.png",St="/SekaiTextWeb/assets/chr_31-Djj1oD5c.png",wt="/SekaiTextWeb/assets/chr_4-DR5QtuEo.png",xt="/SekaiTextWeb/assets/chr_5-DQ6yQz7F.png",Tt="/SekaiTextWeb/assets/chr_6-BWnBW2SV.png",Dt="/SekaiTextWeb/assets/chr_7-D6zS2z8I.png",Ct="/SekaiTextWeb/assets/chr_8-hB7p19qi.png",Wt="/SekaiTextWeb/assets/chr_9-yqwlOP4A.png",It=H({__name:"TranslateDialog",props:{data:{},translateName:{type:Boolean,default:!0}},emits:["update-item"],setup(e,{emit:o}){const t=Q({...ie(e.data)}),c=D("success"),d=D(""),f=D(!1),k=o;ce(t,s=>k("update-item",{...s}),{deep:!0});const h=()=>{if(!t.speakerId)return"";const s=new URL(Object.assign({"/src/assets/icons/chr_1.png":Ze,"/src/assets/icons/chr_10.png":Ke,"/src/assets/icons/chr_11.png":et,"/src/assets/icons/chr_12.png":tt,"/src/assets/icons/chr_13.png":nt,"/src/assets/icons/chr_14.png":at,"/src/assets/icons/chr_15.png":st,"/src/assets/icons/chr_16.png":ot,"/src/assets/icons/chr_17.png":lt,"/src/assets/icons/chr_18.png":rt,"/src/assets/icons/chr_19.png":it,"/src/assets/icons/chr_2.png":ct,"/src/assets/icons/chr_20.png":ut,"/src/assets/icons/chr_21.png":pt,"/src/assets/icons/chr_22.png":_t,"/src/assets/icons/chr_23.png":dt,"/src/assets/icons/chr_24.png":gt,"/src/assets/icons/chr_25.png":ft,"/src/assets/icons/chr_26.png":ht,"/src/assets/icons/chr_27.png":mt,"/src/assets/icons/chr_28.png":vt,"/src/assets/icons/chr_29.png":kt,"/src/assets/icons/chr_3.png":yt,"/src/assets/icons/chr_30.png":bt,"/src/assets/icons/chr_31.png":St,"/src/assets/icons/chr_4.png":wt,"/src/assets/icons/chr_5.png":xt,"/src/assets/icons/chr_6.png":Tt,"/src/assets/icons/chr_7.png":Dt,"/src/assets/icons/chr_8.png":Ct,"/src/assets/icons/chr_9.png":Wt})[`/src/assets/icons/chr_${t.speakerId}.png`],import.meta.url).href;return t.speakerId>0&&t.speakerId<31?s:""},C=s=>!s||!s.includes(`
`),p=s=>!s||s.split(`
`).length<=t.content.origin.split(`
`).length,i=s=>`${s.value.length}(${Math.max(...s.value.split(`
`).map(u=>u.length))})`,x=s=>{t.content.translated=W(s),f.value&&T(t.content.translated).length>0?c.value="error":c.value="success"},W=s=>s.replace(/…/ig,"...").replace(/\(/ig,"（").replace(/\)/ig,"）").replace(/\?/ig,"？").replace(/!/ig,"！").replace(/,/ig,"，").replace(/~/ig,"～").replace(/欸/ig,"诶"),T=s=>{const u=[],V=["、","，","。","？","！","～","♪","☆",".","—"],L=["）","」","』","”"];V.includes(s[s.length-1])?(s.includes("...，")||s.includes("...。"))&&u.push("省略号后不应该有逗号、句号"):L.includes(s[s.length-1])?s.length>1&&!V.includes(s[s.length-2])&&u.push("语句缺少结束标点"):u.push("语句缺少结束标点"),s.includes("—")&&s.split("—").length!=s.split("——").length*2-1&&u.push("破折号使用双破折号");const B=Math.max(...s.split(`
`).map(R=>R.trim().length)),z=35;return B>=z&&u.push(`单行字数过长(${B}>${z})`),d.value=u.join(`
`),u};return(s,u)=>{const V=_e,L=pe,B=Fe,z=Le,R=Y;return m(),O(J,null,[n(R,{class:"translate-card",hoverable:""},{header:a(()=>[n(r(v),{align:"self-start"},{default:a(()=>[h().length>0?(m(),U(V,{key:0,src:h(),height:"60","preview-disabled":"",draggable:"false"},null,8,["src"])):A("",!0),n(r(v),{vertical:"",style:{"{height":"50px}"}},{default:a(()=>[n(r(S),{style:{"font-weight":"bold","font-size":"larger"}},{default:a(()=>[b(P(s.data.speaker.origin),1)]),_:1}),n(r(v),{vertical:""},{default:a(()=>[(m(!0),O(J,null,Z(s.data.content.origin.split(`
`),y=>(m(),U(r(S),{style:{"line-height":"normal"}},{default:a(()=>[b(P(y),1)]),_:2},1024))),256))]),_:1})]),_:1})]),_:1})]),default:a(()=>[t.content.comparison||t.speaker.comparison?(m(),U(B,{key:0},{default:a(()=>[n(L,{value:t.speaker.comparison??"",placeholder:t.speaker.comparison??t.speaker.origin,style:q({width:s.translateName?"25%":"0%"}),type:"textarea",rows:(t.content.comparison??"").split(`
`).length,resizable:!1,readonly:""},null,8,["value","placeholder","style","rows"]),n(L,{value:t.content.comparison??"",style:q({width:s.translateName?"75%":"100%"}),type:"textarea",rows:(t.content.comparison??"").split(`
`).length,placeholder:t.content.comparison??"",resizable:!1,"show-count":"","render-count":i,readonly:""},null,8,["value","style","rows","placeholder"])]),_:1})):A("",!0),n(z,{trigger:"manual",show:f.value&&d.value.length>0},{trigger:a(()=>[n(B,null,{default:a(()=>[n(L,{value:t.speaker.translated,"onUpdate:value":u[0]||(u[0]=y=>t.speaker.translated=y),style:q({width:s.translateName?"25%":"0%"}),type:"textarea",rows:t.content.origin.split(`
`).length,placeholder:t.speaker.origin,resizable:!1,"allow-input":C,clearable:""},null,8,["value","style","rows","placeholder"]),n(L,{value:t.content.translated,"onUpdate:value":[u[1]||(u[1]=y=>t.content.translated=y),x],style:q({width:s.translateName?"75%":"100%"}),type:"textarea",rows:t.content.origin.split(`
`).length,placeholder:t.content.origin,resizable:!1,"show-count":"","render-count":i,"allow-input":p,clearable:"",status:c.value,onFocusin:u[2]||(u[2]=()=>f.value=!0),onFocusout:u[3]||(u[3]=()=>f.value=!1)},null,8,["value","style","rows","placeholder","status"])]),_:1})]),default:a(()=>[(m(!0),O(J,null,Z(d.value.split(`
`),(y,j)=>(m(),U(r(v),{vertical:"",key:j},{default:a(()=>[n(r(S),null,{default:a(()=>[b(P(y),1)]),_:2},1024)]),_:2},1024))),128))]),_:1},8,["show"])]),_:1}),t.isClose?(m(),U(R,{key:0,class:"translate-card",hoverable:""},{default:a(()=>[n(r(v),{justify:"center"},{default:a(()=>[n(r(S),null,{default:a(()=>u[4]||(u[4]=[b("--------------------")])),_:1})]),_:1})]),_:1})):A("",!0)],64)}}}),Et=H({__name:"TranslateEffect",props:{data:{}},emits:["update-item"],setup(e,{emit:o}){const t=Q({...ie(e.data)}),c=o;return ce(t,d=>c("update-item",{...d}),{deep:!0}),(d,f)=>{const k=pe,h=Y;return m(),U(h,{class:"translate-card",hoverable:""},{header:a(()=>[n(r(v),{align:"center",justify:"center"},{default:a(()=>[n(r(S),null,{default:a(()=>[b(P(d.data.content.origin),1)]),_:1})]),_:1})]),default:a(()=>[n(r(v),{align:"center",justify:"center"},{default:a(()=>[n(k,{value:t.content.translated,"onUpdate:value":f[0]||(f[0]=C=>t.content.translated=C),style:{width:"75%",textAlign:"center"},placeholder:"地点翻译"},null,8,["value"])]),_:1})]),_:1})}}});async function se(e){return new Promise(o=>{const t=new FileReader;t.onload=()=>{o(t.result)},t.readAsText(e)})}function oe(e){return e.match(/[\\/]/)?e.split(/[\\/]/).pop():e}function Nt(e,o){return e.replace(/\.\w+$/,o)}const le=new Map([[1,1],[2,2],[3,3],[4,4],[5,5],[6,6],[7,7],[8,8],[9,9],[10,10],[11,11],[12,12],[13,13],[14,14],[15,15],[16,16],[17,17],[18,18],[19,19],[20,20],[21,21],[22,21],[23,21],[24,21],[25,21],[26,21],[27,22],[28,23],[29,24],[30,25],[31,26],[32,1],[33,2],[34,3],[35,4],[36,5],[37,6],[38,7],[39,8],[40,9],[41,10],[42,11],[43,12],[44,13],[45,14],[46,15],[47,16],[48,17],[49,18],[50,19],[51,20],[52,21],[53,22],[54,23],[55,24],[57,26],[58,27],[59,28],[60,29],[61,30],[62,31],[63,32],[64,33],[65,34],[66,35],[67,36],[68,37],[69,38],[70,39],[71,40],[72,41],[73,42],[74,43],[75,44],[76,45],[77,46],[78,47],[79,48],[80,49],[81,50],[82,51],[83,52],[84,53],[85,54],[86,55],[87,56],[88,57],[89,58],[90,59],[91,60],[92,61],[93,62],[94,63],[95,64],[96,65],[97,66],[98,67],[99,68],[100,69],[101,70],[102,71],[103,72],[104,73],[105,74],[106,75],[107,22],[108,23],[109,76],[110,77],[111,78],[112,79],[113,7],[114,25],[115,15],[116,80],[117,13],[118,25],[119,24],[120,22],[121,22],[122,81],[123,82],[124,83],[125,84],[126,13],[127,2],[128,24],[129,85],[130,25],[131,86],[132,87],[133,26],[134,25],[135,88],[136,89],[137,17],[138,24],[139,22],[140,90],[141,11],[142,91],[143,23],[144,4],[145,8],[146,18],[147,26],[148,16],[149,23],[150,22],[151,23],[152,24],[153,24],[154,25],[155,26],[156,21],[157,26],[158,92],[159,93],[160,25],[161,22],[162,23],[163,23],[164,24],[165,22],[166,23],[167,24],[168,25],[169,26],[170,94],[171,95],[172,1],[173,2],[174,3],[175,4],[176,21],[177,22],[178,23],[179,24],[180,25],[181,26],[182,5],[183,5],[184,6],[185,6],[186,7],[187,7],[188,8],[189,8],[190,21],[191,21],[192,22],[193,22],[194,23],[195,23],[196,24],[197,24],[198,25],[199,25],[200,26],[201,26],[202,17],[203,18],[204,19],[205,20],[206,21],[207,22],[208,24],[209,25],[210,96],[211,97],[212,98],[213,99],[214,100],[215,101],[216,102],[217,103],[218,104],[219,22],[220,22],[221,22],[222,22],[223,22],[224,23],[225,23],[226,23],[227,23],[228,24],[229,24],[230,24],[231,24],[232,24],[233,25],[234,25],[235,25],[236,25],[237,25],[238,26],[239,26],[240,26],[241,26],[248,105],[249,106],[250,107],[251,108],[252,23],[253,10],[254,109],[255,110],[256,111],[257,6],[258,80],[259,113],[260,114],[261,115],[262,26],[263,116],[264,17],[265,21],[266,22],[267,23],[268,24],[269,25],[270,26],[271,116],[272,118],[273,119],[274,120],[275,121],[276,122],[277,14],[278,1],[279,2],[280,3],[281,4],[282,5],[283,6],[284,7],[285,8],[286,9],[287,10],[288,11],[289,12],[290,13],[291,14],[292,15],[293,16],[294,17],[295,18],[296,19],[297,20],[298,21],[299,21],[300,21],[301,21],[302,21],[303,21],[304,22],[305,22],[306,22],[307,22],[308,22],[309,22],[310,23],[311,23],[312,23],[313,23],[314,23],[315,23],[316,24],[317,24],[318,24],[319,24],[320,24],[321,24],[322,25],[323,25],[324,25],[325,25],[326,25],[327,25],[328,26],[329,26],[330,26],[331,26],[332,26],[333,26],[334,26],[335,27],[336,30],[337,31],[338,74],[339,75],[340,4],[341,123],[342,124],[343,125],[344,20],[345,126],[346,127],[347,128],[348,11],[349,129],[900,1],[901,2],[902,3],[903,4],[904,5],[905,6],[906,1],[907,4],[908,5],[909,6],[9e5,9e5]]);function Ut(e){if(e.Voices.length!=1&&e.TalkCharacters.length!=1)return 0;if(e.TalkCharacters.length==1){const o=le.get(e.TalkCharacters[0].Character2dId)??0;if(o>=1&&o<=26)return o}else{const o=le.get(e.Voices[0].Character2dId)??0;if(o>=1&&o<=26)return o}}function Ft(e){return e.Action!==void 0&&e.ProgressBehavior!==void 0&&e.ReferenceIndex!==void 0&&e.Delay!==void 0}function Lt(e){return e.TalkCharacters!==void 0&&e.WindowDisplayName!==void 0&&e.Body!==void 0&&e.TalkTention!==void 0&&e.LipSync!==void 0&&e.MotionChangeFrom!==void 0&&e.Motions!==void 0&&e.Voices!==void 0&&e.Speed!==void 0&&e.FontSize!==void 0&&e.WhenFinishCloseWindow!==void 0&&e.RequirePlayEffect!==void 0&&e.EffectReferenceIdx!==void 0&&e.RequirePlaySound!==void 0&&e.SoundReferenceIdx!==void 0}function Rt(e){return e.EffectType!==void 0&&e.StringVal!==void 0&&e.StringValSub!==void 0&&e.Duration!==void 0&&e.IntVal!==void 0}function Vt(e){const o=e.Snippets&&e.Snippets.every(Ft),t=e.TalkData&&e.TalkData.every(Lt),c=e.SpecialEffectData&&e.SpecialEffectData.every(Rt);return e.ScenarioId!==void 0&&o&&t&&c}function Bt(e){const t=(p=>{const i=[];let x=0,W=0,T=!1;return p.Snippets.forEach(s=>{switch(s.Action){case 1:T&&i.push(x),x+=1;break;case 6:let u=p.SpecialEffectData[W];switch(u.EffectType){case 6:i.push(x-1),u.Duration>10&&(T=!0);break;case 26:T=!1;break}}}),i})(e),c=[];let d=0;e.Snippets.forEach(p=>{switch(p.Action){case 1:c.push(p);break;case 6:switch(e.SpecialEffectData[d].EffectType){case 8:case 18:c.push(p);break}d+=1;break}}),e.Snippets=c,e.SpecialEffectData=e.SpecialEffectData.filter(p=>p.EffectType==8||p.EffectType==18);const f=p=>t.includes(p),k=[];let h=0,C=0;return e.Snippets.forEach(p=>{switch(p.Action){case 1:const i=e.TalkData[h];if(h<e.TalkData.length){const W={id:h,type:"dialog",speakerId:Ut(i),speaker:{origin:i.WindowDisplayName,translated:i.WindowDisplayName},content:{origin:i.Body,translated:""},isShake:f(h),isFlashBack:!1,isClose:i.WhenFinishCloseWindow==1};k.push(W)}h+=1;break;case 6:const x=e.SpecialEffectData[C];switch(x.EffectType){case 8:case 18:const W={id:C,type:"effect",content:{origin:x.StringVal,translated:x.StringVal}};k.push(W);break}C+=1;break}}),k}const ee=(e,o)=>{if(e.length!=o.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!=o[t].type)return!1;return!0};function $t(e,o){if(ee(e,o))for(let t=0;t<e.length;t++)e[t].content.translated=o[t].content.translated,e[t].type=="dialog"&&(e[t].speaker.translated=o[t].speaker.translated);return e}function zt(e,o){if(ee(e,o))for(let t=0;t<e.length;t++)e[t].content.comparison=o[t].content.translated,e[t].type=="dialog"&&(e[t].speaker.comparison=o[t].speaker.translated);return e}function Ot(e){const o=[];return e.split(`
`).map(t=>t.trim()).forEach(t=>{if(t.length!=0)if(t.includes("：")){const c={id:o.length,type:"dialog",isClose:!1,isFlashBack:!1,isShake:!1,speaker:{translated:t.split("：")[0],origin:t.split("：")[0]},content:{translated:t.split("：")[1],origin:t.split("：")[1]}};o.push(c)}else{const c={id:o.length,type:"effect",content:{translated:t,origin:t}};o.push(c)}}),o}function At(e){let o=[];return e.forEach(t=>{const c=t.content.translated.replace(`
`,"\\N");if(t.type=="dialog"){const d=t.speaker.translated;o.push(`${d}：${c}`)}else o.push(c)}),o.join(`
`)}const Mt={style:{"margin-bottom":"12px"}},re=H({__name:"TranslateUpload",props:{onUpload:{type:Function}},setup(e){return(o,t)=>{const c=v,d=Re,f=Ve,k=Y;return m(),U(k,null,{default:a(()=>[n(f,{"default-upload":!1,"show-file-list":!1,max:1,onChange:o.onUpload,"trigger-style":"height: 100%",style:{height:"100%"}},{default:a(()=>[n(d,{style:{height:"100%",width:"100%"}},{default:a(()=>[n(c,{vertical:"",justify:"center",style:{height:"100%"}},{default:a(()=>[Te("div",Mt,[n(r(K),{size:"48",depth:"3"},{default:a(()=>[n(r(ue))]),_:1})]),n(r(S),{style:{"font-size":"16px"}},{default:a(()=>t[0]||(t[0]=[b(" 点击或者拖动文件到该区域来上传 ")])),_:1})]),_:1})]),_:1})]),_:1},8,["onChange"])]),_:1})}}}),Qt="https://raw.githubusercontent.com/Sekai-World/sekai-master-db-diff/refs/heads/main/events.json";async function Jt(e=!1){if(Date.now()-parseInt(localStorage.getItem("eventDataUpdateTime")??"0")>1e3*60*60*24||e){const o=await(await fetch(Qt)).json();return o&&(localStorage.setItem("eventDataUpdateTime",Date.now().toString()),localStorage.setItem("eventData",JSON.stringify(o))),o}else return JSON.parse(localStorage.getItem("eventData")??"[]")}const cn=H({__name:"TranslatePage",setup(e){const o=(_,l)=>{const I=(E,w)=>{for(let g=0;g<i.length;g++)if(i[g].type=="dialog"){const $=i[g];$.speaker.origin==E&&($.speaker.translated=w,i[g]=$)}};switch(l.type){case"dialog":i[_]=l,I(l.speaker.origin,l.speaker.translated);break;case"effect":i[_]=l;break}y()},t=(_,l)=>()=>F(K,l,{default:()=>F(_)}),c=Be(),d=D(!0),f=D(!1),k=D(!1),h=D(!1),C=D(""),p=D(""),i=Q([]),x=D(""),W=D(""),T=Q([]),s=Q([]),u=()=>{for(;i.length>0;)i.pop();for(i.push(...T),p.value=W.value,C.value=x.value;T.length>0;)T.pop();h.value=!1,y()},V=async _=>{f.value=!1;const l=w=>{let g;try{g=JSON.parse(w)}catch($){c.error(`文件读取错误
${$}`);return}if(Vt(g)){for(W.value=oe(E.name),x.value=g.ScenarioId.length>0?g.ScenarioId:oe(E.name);T.length>0;)T.pop();T.push(...Bt(g)),p.value.length>0&&p.value!=W.value?h.value=!0:u()}else c.error("文件格式不支持")},I=w=>{if(i.length==0){c.error("请先加载Json/Asset剧本文件");return}const g=Ot(w);if(!ee(Array.from(i.values()),g)){c.error("翻译文件结构不匹配");return}for(;s.length>0;)s.pop();s.push(...g),k.value=!0},E=_.file.file;if(E.name.toLowerCase().endsWith(".json")||E.name.toLowerCase().endsWith(".asset")){const w=await se(E);l(w)}else if(E.name.toLowerCase().endsWith(".txt")){const w=await se(E);I(w)}else c.error("文件格式不支持");_.fileList=[]},L=()=>{for(k.value=!1,$t(i,s);s.length>0;)s.pop();y()},B=()=>{for(k.value=!1,zt(i,s);s.length>0;)s.pop();y()},z=_=>{var l;p.value.length!=0&&(l=_.dataTransfer)!=null&&l.types.every(I=>I=="Files")&&(f.value=!0)},R=D(!0),y=(_=!0)=>{localStorage.setItem("translate",JSON.stringify(i)),localStorage.setItem("sourceFile",p.value),_&&R.value&&(c.success("保存成功"),R.value=!1,setTimeout(()=>R.value=!0,1e3*60))},j=()=>{for(;i.length>0;)i.pop();for(;s.length>0;)s.pop();p.value="",y(!1),c.success("清除完成")},de=()=>{const _=new Blob([At(i)],{type:"application/plain"}),l=URL.createObjectURL(_),I=document.createElement("a");I.href=l,I.download=Nt(p.value,".txt"),I.click(),URL.revokeObjectURL(l)},ge=()=>{const _=localStorage.getItem("translate"),l=localStorage.getItem("sourceFile");_&&l&&(i.push(...JSON.parse(_)),p.value=l,c.success("已加载缓存数据")),y()},fe=async()=>{await Jt(!0)?c.success("闪回数据已更新"):c.error("闪回数据更新失败")};De(async()=>{localStorage.getItem("sourceFile")&&ge()});const he=new URL("/SekaiTextWeb/icon.ico",import.meta.url).href,me=[{label:"Sekai Text",key:"Home",icon:()=>F(_e,{previewDisabled:!0,src:he,style:{height:"24px",width:"24px"}})},{key:"divider-1",type:"divider"},{label:()=>F("a",{onClick:()=>f.value=!0},"上传文件"),key:"Upload",icon:t(ue)},{label:()=>F("a",{onClick:y},"保存数据"),key:"Save",icon:t(Ce)},{label:()=>F("a",{onClick:de},"下载数据"),key:"Download",icon:t(We)},{label:()=>F("a",{onClick:j},"清除数据"),key:"Clear",icon:t(Ie)},{key:"divider-2",type:"divider"},{label:()=>F("a",{onClick:fe},"更新闪回数据"),key:"Refresh",disabled:!0,show:!1,icon:t(Ee)},{label:()=>F("a",{onClick:()=>Ge.emit(Xe.ChangeTheme)},"切换主题"),key:"Theme",icon:t(Ne)}],ve=[{label:"「」",value:"「」"},{label:"『』",value:"『』"},{label:"《》",value:"《》"},{label:"“”",value:"“”"},{label:"～",value:"～"},{label:"♪",value:"♪"},{label:"☆",value:"☆"},{label:"——",value:"——"}],ke=_=>{navigator.clipboard.writeText(_),c.success(`已复制：${_}`)};return(_,l)=>{const I=ze,E=$e,w=Je,g=Qe,$=Pe,ye=Me,be=Ae,Se=He,we=qe,xe=Ye,te=Oe,G=je,ne=Y;return m(),O("div",null,[n(te,{"has-sider":"",class:"app full-height full-width",onDragover:z},{default:a(()=>[n(E,{bordered:"","collapse-mode":"width","collapsed-width":40,width:240,collapsed:d.value,"show-trigger":"bar",onCollapse:l[0]||(l[0]=()=>{d.value=!0}),onExpand:l[1]||(l[1]=()=>{d.value=!1})},{default:a(()=>[n(I,{collapsed:d.value,"collapsed-width":40,"collapsed-icon-size":20,options:me},null,8,["collapsed"])]),_:1},8,["collapsed"]),n(te,{embedded:"","native-scrollbar":!1,style:{height:"100vh"}},{default:a(()=>[n(be,{bordered:"",style:{padding:"10px 30px 10px 30px",height:"85px"}},{default:a(()=>[n(ye,{cols:5},{default:a(()=>[n(g,{span:"3"},{default:a(()=>[n(w,{label:"剧本文件"},{default:a(()=>[n(r(S),null,{default:a(()=>[b(P(C.value.length==0?"未选择":C.value),1)]),_:1})]),_:1})]),_:1}),n(g,null,{default:a(()=>[n(w,{label:"剧本长度",value:i.length},null,8,["value"])]),_:1}),n(g,null,{default:a(()=>[n(w,{label:"操作"},{default:a(()=>[n(r(v),{align:"stretch",justify:"start"},{default:a(()=>[n($,{options:ve,"onUpdate:value":ke},{default:a(()=>[n(r(M),null,{default:a(()=>[n(r(v),null,{default:a(()=>[n(r(K),null,{default:a(()=>[n(r(Ue))]),_:1}),n(r(S),null,{default:a(()=>l[6]||(l[6]=[b("常用字符")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),n(we,{bordered:"","native-scrollbar":!1,style:{height:"calc(100vh - 90px)"}},{default:a(()=>[p.value.length==0?(m(),U(r(v),{key:0,align:"center",justify:"center",style:{height:"calc(100vh - 90px)"}},{default:a(()=>[n(re,{"on-upload":V,style:{width:"90%",height:"80%"}})]),_:1})):A("",!0),n(Se,null,{default:a(()=>[n(r(v),{style:{padding:"20px 5px 20px 5px"},vertical:""},{default:a(()=>[(m(!0),O(J,null,Z(i,(N,ae)=>(m(),O(J,{key:`${p.value}-${N.id}`},[N.type=="dialog"?(m(),U(It,{key:0,data:N,onUpdateItem:X=>o(ae,X)},null,8,["data","onUpdateItem"])):A("",!0),N.type=="effect"?(m(),U(Et,{key:1,data:N,onUpdateItem:X=>o(ae,X)},null,8,["data","onUpdateItem"])):A("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),n(xe)]),_:1})]),_:1}),n(G,{show:f.value,"onUpdate:show":l[2]||(l[2]=N=>f.value=N)},{default:a(()=>[n(re,{"on-upload":V,style:{width:"80%",height:"40vh"}})]),_:1},8,["show"]),n(G,{show:k.value,"onUpdate:show":l[3]||(l[3]=N=>k.value=N)},{default:a(()=>[n(ne,{style:{height:"60%",width:"80%"}},{default:a(()=>[n(r(v),{vertical:""},{default:a(()=>[n(r(S),null,{default:a(()=>l[7]||(l[7]=[b("将翻译文件加载为：")])),_:1}),n(r(v),{justify:"space-around"},{default:a(()=>[n(r(M),{onClick:L},{default:a(()=>[n(r(S),null,{default:a(()=>l[8]||(l[8]=[b("翻译文本")])),_:1})]),_:1}),n(r(M),{onClick:B},{default:a(()=>[n(r(S),null,{default:a(()=>l[9]||(l[9]=[b("对照文本")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"]),n(G,{show:h.value,"onUpdate:show":l[5]||(l[5]=N=>h.value=N)},{default:a(()=>[n(ne,{style:{height:"60%",width:"80%"}},{default:a(()=>[n(r(v),{vertical:""},{default:a(()=>[n(r(S),null,{default:a(()=>l[10]||(l[10]=[b("确定要覆盖加载剧本文件吗：")])),_:1}),n(r(v),{justify:"space-around"},{default:a(()=>[n(r(M),{type:"error",onClick:u},{default:a(()=>[n(r(S),null,{default:a(()=>l[11]||(l[11]=[b("是")])),_:1})]),_:1}),n(r(M),{onClick:l[4]||(l[4]=()=>h.value=!1)},{default:a(()=>[n(r(S),null,{default:a(()=>l[12]||(l[12]=[b("否")])),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["show"])])}}});export{cn as default};
